{% extends 'finance_tracker/base.html' %} 
{% load static %}

{% block content %}
<div class="m-3 min-vh-100">
    <h1>All Transactions</h1>
    <table id="myTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Category</th>
                <th>Description</th>
                <th>Amount</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>
</div>
{% endblock content %} 

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        console.log('Javascript block is executing');
        {% comment %} console.log('Raw transactions_json:', `{{ transactions_json|safe }}`); // Using backticks (template literals) {% endcomment %}
        const transactionsData = JSON.parse(`{{ transactions_json|safe }}`); // Using backticks here too
        console.log('Parsed transactionsData:', transactionsData);

        // 2. Prepare data for simpleDatatables (assuming 'fields' structure from Django serializer)
        const tableData = {
            headings: ["Date", "Category", "Description", "Amount"],
            rows: transactionsData.map(transaction => {
                return [
                    transaction.date,
                    transaction.category,
                    transaction.description,
                    transaction.amount
                ];
            })
        };
        console.log('tableData:', tableData);

        setTimeout(function() { // Introduce a small delay
            console.log('Initializing DataTable with:', tableData); // Logging before init
            try {
                const dataTable = new simpleDatatables.DataTable("#myTable", {
                    searchable: true,
                    fixedHeight: true,
                    data: tableData
                });
                console.log('DataTable initialized successfully:'); // Success log
            } catch (error) {
                console.error('Error initializing DataTable:', error); // Error log
            }
        }, 50); // 50 milliseconds delay - adjust if needed
    });
    
</script>
{% endblock extra_js %}